<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>GamesPlanet Final Order Converter</title>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    textarea { width: 100%; height: 250px; font-size: 14px; }
    pre { background: #f0f0f0; padding: 10px; white-space: pre-wrap; font-size: 14px; }
    button { padding: 10px 15px; font-size: 14px; margin: 4px; cursor: pointer; }
  </style>
</head>
<body>

<h2>GamesPlanet Final Order Converter (Full Final Patched)</h2>

<textarea id="input" placeholder="Paste order details here"></textarea><br><br>

<button onclick="selectAll()">Select All</button>
<button onclick="clearText()">Clear</button>
<button onclick="convert()">Convert</button>
<button onclick="copyAll()">Copy All</button>
<button onclick="sendToCustomer()">Send to Customer WhatsApp</button>
<button onclick="sendToOwn()">Send to Own WhatsApp</button>
<button onclick="sendThanks()">Send Thanks</button>
<button onclick="sendAbandonedCart()">Send Abandoned Cart WhatsApp</button>

<pre id="output"></pre>

<script>
// Product list
const products = [
  "gd30 v1","gd30 v2","gd30 v3",
  "m33 v1","m33 v2","m33 v3",
  "m22 v1","m22 v2","m22 v3",
  "gd10 v1","gd10 v2","gd10 v3",
  "m88","pandora mini","pandora pro",
  "gamestick lite","gamestick pro","aoko gamestick",
  "sega 16bit mini u box","sup x7m","black hawk",
  "fmcb","fmcb + usb","usb",
  "gd35 v1","gd35 v2","gd35 v3",
  "gamestick blaster","m44","k8",
  "g10v3","g10 v3","g11 pro v3","g10",
  "g11 pro v1","g11pro v1","g11pro v3"
];

// Variant list
const variants = ["64gb","128gb","256gb","500gb","1tb","64gb optional","128gb optional","256gb optional","500gb optional","1tb optional","dual","single"];

function selectAll() { let input = document.getElementById("input"); input.focus(); input.select(); }
function clearText() { document.getElementById("input").value = ""; document.getElementById("output").textContent = ""; }

function estimateDeliveryByDistance(distance) {
  if (distance <= 30) return "1 day";
  else if (distance <= 60) return "1-2 days";
  else if (distance <= 100) return "2-3 days";
  else if (distance <= 200) return "3-4 days";
  else if (distance <= 500) return "4-5 days";
  else if (distance <= 1000) return "4-6 days";
  else if (distance <= 1500) return "5â€“7 days";
  else if (distance <= 2000) return "6â€“8 days";
  else if (distance <= 3000) return "6â€“10 days";
  else return "8â€“12 days (sometimes up to 15 days)";
}

function convert() {
  let input = document.getElementById("input").value.toLowerCase();

  let orderId = input.match(/#\d{5,}/)?.[0] || "Not found";
  let name = input.match(/name\s*\n([^\n]+)/i)?.[1].trim() || "Customer";
  let mobile = input.match(/mobile\s*\n([^\n]+)/i)?.[1].trim() || "";
  let altMobile = input.match(/alternate mobile number\s*\n([^\n]+)/i)?.[1].trim() || "";
  let email = input.match(/email\s*\n([^\n]+)/i)?.[1].trim() || "";
  let address = input.match(/shipping address\s*\n([^\n]+)/i)?.[1].trim() || "";
  let pincode = input.match(/\b\d{6}\b/)?.[0] || "";
  let basePrice = input.match(/1x\s*â‚¹([\d,]+)/i)?.[1].replace(/,/g,"") || "0";

  let discount = "0";
  if (input.includes("coupon discount")) {
    let d = input.match(/coupon discount[^\n]*\n-â‚¹(\d+)/i);
    discount = d ? d[1] : "0";
  }

  let amountPaid = input.match(/total\s*paid\s*â‚¹([\d,]+)/i)?.[1].replace(/,/g,"") || "0";

  // Product detection
  products.sort((a,b) => b.length - a.length);
  let detectedProduct = "";
  for (let p of products) {
    if (input.includes(p)) {
      detectedProduct = p.toUpperCase();
      break;
    }
  }

  // If no product detected, extract original product name from '1 item' block
  if (!detectedProduct) {
    let prodMatch = input.match(/1 item[\s\S]*?\n([^\n]+)/i);
    detectedProduct = prodMatch ? prodMatch[1].trim() : "Unknown Product";
  }

  // Variant detection
  let variant = "";
  for (let v of variants) {
    if (input.includes(v)) {
      variant = v.toUpperCase();
      break;
    }
  }

  // If no variant detected, extract original variant/size from input or fallback
  if (!variant) {
    let variantMatch = input.match(/size[:\s]*([^\n]+)/i);
    if (variantMatch) {
      variant = variantMatch[1].trim().toUpperCase();
    } else {
      const variantMap = {
        "m88": "128GB",
        "pandora pro": "128GB",
        "pandora mini": "64GB",
        "gamestick pro": "128GB",
        "gamestick lite": "64GB"
      };
      variant = variantMap[detectedProduct.toLowerCase()] || "";
    }
  }

  // Static distance for now
  let distance = "197 km";
  let eta = estimateDeliveryByDistance(197);

  let outputText = 
`ğŸŸ¢ Prepaid Order on Dukaan

Order ID: ${orderId}
Name: ${name}
Mobile: ${mobile}
Alt Mobile: ${altMobile}
Email: ${email}

Address: ${address}
Pincode: ${pincode}

Product: ${detectedProduct}
Variant: ${variant}
Base Price: â‚¹${basePrice}
Discount Applied: â‚¹${discount}
Amount Paid: â‚¹${amountPaid}
Distance: ${distance}
Estimated Delivery: ${eta}`;

  document.getElementById("output").textContent = outputText;
}

function copyAll() {
  navigator.clipboard.writeText(document.getElementById("output").textContent).then(() => alert("Output copied to clipboard!"));
}

function sendToCustomer() {
  let o = document.getElementById("output").textContent;
  let mobile = o.match(/Mobile: ([^\n]+)/)?.[1].replace(/\s|-/g,"") || "";
  let msg = encodeURIComponent(o);
  if(mobile) window.open(`https://wa.me/91${mobile}?text=${msg}`, "_blank"); else alert("Customer mobile number not found in output.");
}

function sendToOwn() {
  let msg = encodeURIComponent(document.getElementById("output").textContent);
  window.open(`https://wa.me/917983624797?text=${msg}`, "_blank");
}

function sendThanks() {
  let o = document.getElementById("output").textContent;
  let name = o.match(/Name: ([^\n]+)/)?.[1] || "Customer";
  let orderId = o.match(/Order ID: ([^\n]+)/)?.[1] || "Not found";
  let product = o.match(/Product: ([^\n]+)/)?.[1].trim() || "";
  let variant = o.match(/Variant: ([^\n]+)/)?.[1].trim() || "";
  let distance = o.match(/Distance: ([^\n]+)/)?.[1] || "";
  let eta = o.match(/Estimated Delivery: ([^\n]+)/)?.[1] || "";

  let msg = encodeURIComponent(
`ğŸŒŸ GamesPlanet
ğŸ™ Hello ${name} ji, thank you for your order ${orderId}.
ğŸ“¦ Product: ${product} (${variant})
ğŸ“ Distance: ${distance}
â³ Estimated Delivery: ${eta}
ğŸšš Your order will be shipped soon between 8PMâ€“10PM.
ğŸ”— Tracking will update on our website after dispatch.
ğŸ–¼ï¸ On request, we can send *parcel pic & tracking details* here on WhatsApp.
ğŸ’š Team GamesPlanet`);

  let mobile = o.match(/Mobile: ([^\n]+)/)?.[1].replace(/\s|-/g,"") || "";
  if(mobile) window.open(`https://wa.me/91${mobile}?text=${msg}`, "_blank"); else alert("Customer mobile number not found in output.");
}

function sendAbandonedCart() {
  let o = document.getElementById("output").textContent;
  let name = o.match(/Name: ([^\n]+)/)?.[1] || "Customer";
  let orderId = o.match(/Order ID: ([^\n]+)/)?.[1] || "Not found";
  let product = o.match(/Product: ([^\n]+)/)?.[1].trim() || "";
  let variant = o.match(/Variant: ([^\n]+)/)?.[1].trim() || "";
  let basePrice = parseInt(o.match(/Base Price: â‚¹([\d,]+)/)?.[1].replace(/,/g, '') || "0");
  let discount = parseInt(o.match(/Discount Applied: â‚¹([\d,]+)/)?.[1].replace(/,/g, '') || "0");
  let prepaidAmount = basePrice - discount;
  let codAdvance = Math.max(500, Math.round(basePrice * 0.10));
  let codRemaining = basePrice - codAdvance;
  let distance = o.match(/Distance: ([^\n]+)/)?.[1] || "";
  let eta = o.match(/Estimated Delivery: ([^\n]+)/)?.[1] || "";

  let msg = encodeURIComponent(
`ğŸŒŸ GamesPlanet

ğŸ™ Hello ${name} ji,

ğŸ“ Incomplete Order Details:
â€“ Order ID: ${orderId}
â€“ Product: ${product} (${variant})
â€“ Base Price: â‚¹${basePrice}

ğŸ’° Prepaid Offer: â‚¹${basePrice} â€“ â‚¹${discount} discount = â‚¹${prepaidAmount}
ğŸšš Estimated Delivery: ${eta}

ğŸ’µ COD: â‚¹${basePrice} (no discount)
â¡ COD Advance: â‚¹${codAdvance}
â¡ Remaining on Delivery: â‚¹${codRemaining}
ğŸ“ Distance: ${distance}
ğŸšš COD Estimated Delivery: ${eta}

ğŸ‘‰ Complete payment soon to confirm your order.
ğŸ’š Team GamesPlanet`);

  let mobile = o.match(/Mobile: ([^\n]+)/)?.[1].replace(/\s|-/g,"") || "";
  if(mobile) window.open(`https://wa.me/91${mobile}?text=${msg}`, "_blank"); else alert("Customer mobile number not found in output.");
}
</script>

</body>
</html>
